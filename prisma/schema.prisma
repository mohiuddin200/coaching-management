generator client {
  provider   = "prisma-client-js"
  output     = "../src/generated/prisma"
  engineType = "binary"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id             String   @id @default(uuid())
  email          String   @unique
  role           UserRole @default(Teacher)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  teacherProfile Teacher? @relation("UserToTeacher")

  @@map("users")
}

model Teacher {
  id                       String         @id @default(uuid())
  firstName                String
  lastName                 String
  email                    String?
  phoneNumber              String
  subject                  String?
  qualifications           String?
  joinDate                 DateTime       @default(now())
  status                   Status         @default(Active)
  createdAt                DateTime       @default(now())
  updatedAt                DateTime       @updatedAt
  userId                   String?        @unique
  bloodGroup               BloodGroup?
  cgpa                     Float?
  city                     String?
  country                  String?
  cv                       String?
  dateOfBirth              DateTime?
  emergencyContactName     String?
  emergencyContactPhone    String?
  emergencyContactRelation String?
  gender                   Gender?
  idProof                  String?
  nationality              String?
  nid                      String?        @unique
  paymentType              PaymentType?
  postalCode               String?
  profileImage             String?
  religion                 String?
  salary                   Float?
  state                    String?
  streetAddress            String?
  universityName           String?
  classSections            ClassSection[] @relation("TeacherToClassSection")
  classes                  Class[]        @relation("TeacherToClass")
  user                     User?          @relation("UserToTeacher", fields: [userId], references: [id])

  @@map("teachers")
}

model Student {
  id                       String       @id @default(uuid())
  firstName                String
  lastName                 String
  email                    String
  phoneNumber              String
  dateOfBirth              DateTime?
  address                  String
  enrollmentDate           DateTime     @default(now())
  status                   Status       @default(Active)
  smsEnabled               Boolean      @default(false)
  createdAt                DateTime     @default(now())
  updatedAt                DateTime     @updatedAt
  levelId                  String
  birthCertificate         String?
  bloodGroup               BloodGroup?
  city                     String?
  country                  String?
  emergencyContactName     String?
  emergencyContactPhone    String?
  emergencyContactRelation String?
  fatherName               String
  fatherPhone              String
  gender                   Gender?
  idProof                  String?
  motherName               String
  motherPhone              String
  nationality              String?
  postalCode               String?
  previousClass            String?
  previousMarks            Float?
  previousSchool           String?
  profileImage             String?
  religion                 String?
  state                    String?
  streetAddress            String?
  attendances              Attendance[]
  enrollments              Enrollment[]
  level                    Level        @relation(fields: [levelId], references: [id])

  @@map("students")
}

model Level {
  id          String    @id @default(cuid())
  name        String    @unique
  levelNumber Int       @unique
  description String?
  status      Status    @default(Active)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  students    Student[]
  subjects    Subject[]

  @@map("levels")
}

model Subject {
  id            String         @id @default(cuid())
  name          String
  code          String?
  description   String?
  levelId       String
  status        Status         @default(Active)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  classSections ClassSection[]
  level         Level          @relation(fields: [levelId], references: [id], onDelete: Cascade)

  @@unique([levelId, name])
  @@map("subjects")
}

model ClassSection {
  id           String       @id @default(cuid())
  name         String
  subjectId    String
  teacherId    String
  capacity     Int          @default(30)
  roomNumber   String?
  academicYear String
  status       ClassStatus  @default(Scheduled)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  attendances  Attendance[]
  subject      Subject      @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  teacher      Teacher      @relation("TeacherToClassSection", fields: [teacherId], references: [id])
  enrollments  Enrollment[]
  schedules    Schedule[]

  @@map("class_sections")
}

model Schedule {
  id             String       @id @default(cuid())
  classSectionId String
  dayOfWeek      DayOfWeek
  startTime      String
  endTime        String
  status         Status       @default(Active)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  classSection   ClassSection @relation(fields: [classSectionId], references: [id], onDelete: Cascade)

  @@map("schedules")
}

model Class {
  id           String       @id @default(cuid())
  name         String
  scheduleTime DateTime
  capacity     Int
  status       ClassStatus  @default(Scheduled)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  teacherId    String
  attendances  Attendance[]
  teacher      Teacher      @relation("TeacherToClass", fields: [teacherId], references: [id])
  enrollments  Enrollment[]

  @@map("classes")
}

model Enrollment {
  id             String           @id @default(cuid())
  enrollmentDate DateTime         @default(now())
  status         EnrollmentStatus @default(Active)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  studentId      String
  classId        String?
  classSectionId String?
  class          Class?           @relation(fields: [classId], references: [id])
  classSection   ClassSection?    @relation(fields: [classSectionId], references: [id], onDelete: Cascade)
  student        Student          @relation(fields: [studentId], references: [id])

  @@map("enrollments")
}

model Attendance {
  id             String           @id @default(cuid())
  date           DateTime         @db.Date
  status         AttendanceStatus
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  studentId      String
  classSectionId String
  deviceId       String?
  classSection   ClassSection     @relation(fields: [classSectionId], references: [id], onDelete: Cascade)
  device         BiometricDevice? @relation(fields: [deviceId], references: [id])
  student        Student          @relation(fields: [studentId], references: [id])
  class          Class?           @relation(fields: [classId], references: [id])
  classId        String?

  @@unique([studentId, classSectionId, date])
  @@map("attendances")
}

model BiometricDevice {
  id          String       @id @default(cuid())
  name        String
  apiEndpoint String
  apiKey      String?
  status      String       @default("active")
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  attendances Attendance[]

  @@map("biometric_devices")
}

model SmsLog {
  id             String    @id @default(cuid())
  recipientPhone String
  messageContent String
  status         SmsStatus @default(Pending)
  cost           Float?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@map("sms_logs")
}

model MarketingContact {
  id            String    @id @default(cuid())
  parentName    String
  phoneNumber   String    @unique
  queryDetails  String?
  lastContacted DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("marketing_contacts")
}

model Feedback {
  id        String         @id @default(cuid())
  userId    String?
  userName  String?
  email     String?
  type      FeedbackType   @default(General)
  subject   String
  message   String
  status    FeedbackStatus @default(Open)
  priority  Priority       @default(Medium)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  @@map("feedbacks")
}

enum Gender {
  Male
  Female
  Other
}

enum BloodGroup {
  A_Positive
  A_Negative
  B_Positive
  B_Negative
  AB_Positive
  AB_Negative
  O_Positive
  O_Negative
}

enum UserRole {
  Admin
  Teacher
  Staff
}

enum Status {
  Active
  Inactive
}

enum ClassStatus {
  Scheduled
  InProgress
  Completed
  Cancelled
}

enum EnrollmentStatus {
  Active
  Withdrawn
  Completed
}

enum SmsStatus {
  Sent
  Failed
  Pending
}

enum DayOfWeek {
  Monday
  Tuesday
  Wednesday
  Thursday
  Friday
  Saturday
  Sunday
}

enum FeedbackType {
  General
  BugReport
  FeatureRequest
  Support
  Complaint
  Suggestion
}

enum FeedbackStatus {
  Open
  InProgress
  Resolved
  Closed
}

enum Priority {
  Low
  Medium
  High
  Urgent
}

enum PaymentType {
  SALARIED
  HOURLY
  PER_CLASS
}

enum AttendanceStatus {
  Present
  Absent
}
